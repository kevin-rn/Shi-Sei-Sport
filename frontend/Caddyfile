:80 {
	encode gzip

	handle /api/* {
		reverse_proxy backend:3000
	}

	handle /graphql {
		reverse_proxy backend:3000
	}

	handle /admin* {
		reverse_proxy backend:3000
	}

	handle /_next/* {
		reverse_proxy backend:3000
	}

	handle_path /media/* {
		rewrite * /judo-bucket{path}
		reverse_proxy minio:9000
	}

	# News detail pages: proxy to OG server for server-side meta injection
	handle /news/* {
		reverse_proxy og-server:3001
	}

	handle {
		root * /usr/share/caddy
		try_files {path} /index.html
		file_server
	}
}
